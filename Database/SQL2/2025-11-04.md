# Managing Tables

## DDL(데이터의 기본 구조 및 형식 변경) : CREATE, DROP, ALTER

## CREATE

```sql
CREATE TABLE examples(
  ExamId INTEGER PRIMARY KEY AUTOINCREMENT,
  LastName VARCHAR(50) NOT NULL,
  FirstName VARCHAR(50) NOT NULL
);
```

### 대표 제약 조건 3가지 : 테이블의 필드에 적용되는 규칙(무결성 유지, 일관성 보장)

- **PRIMARY KEY**
    - 해당 필드를 기본 키로 지정
    - `INTEGER` 타입에만 적용되며 `INT`, `BIGINT` 등과 같은 다른 정수 유형에는 적용되지 않음
- **NOT NULL**
    - 해당 필드에 NULL 값을 허용하지 않 도록 지정
- **FOREIGN KEY**
    - 다른 테이블과의 외래 키 관계를 정의

### AUTOINCREMENT 특징

- 필드의 자동 증가를 나타내는 특수한 키워드
- 주로  primary key필드에 적용
- INTEGER PRIMARY KEY AUTOINCREMENT가 작성된 필드는 항상 새로운 레코드에 대해 이전 최대 값보다 큰 값을 할당
- 삭제된 값은 무시되며 재사용할 수 없게 됨

# Modifying table fields

## ALTER TABLE

| 명령어 | 역할 |
| --- | --- |
| `ALTER TABLE ADD COLUMN` | 필드 추가 |
| `ALTER TABLE RENAME COLUMN` | 필드 이름 변경 |
| `ALTER TABLE DROP COLUMN` | 필드 삭제 |
| `ALTER TABLE RENAME TO` | 테이블 이름 변경  |

```sql
-- 2. Modifying table fields
-- 2.1 ADD COLUMN
ALTER TABLE 
  examples
ADD COLUMN
  Country VARCHAR(100) NOT NULL DEFAULT 'default value';

ALTER TABLE
  examples
ADD COLUMN
  Age INTEGER NOT NULL DEFAULT 0;

ALTER TABLE
  examples
ADD COLUMN
  Address VARCHAR(100) NOT NULL DEFAULT 'default value';
-- sqlite는 단일 문을 사용하여 한번에 여러 열을 추가하는 것을 지원하지 않음

-- 2.2 RENAME COLUMN
ALTER TABLE
  examples
RENAME COLUMN
  Address TO PostCode;

-- 2.3 DROP COLUMN
ALTER TABLE 
  examples
DROP COLUMN
  PostCode;

-- 2.4 RENAME TO
ALTER TABLE
  examples
RENAME TO
  new_examples;
```

## DROP

```sql
-- 3. Delete a table
DROP TABLE new_examples;
```

# Modifying Data

## DML(데이터 조작: 추가, 수정, 삭제) : INSERT, UPDATE, DELETE

## INSERT

```sql
-- 1. Insert data into table
INSERT INTO 
  articles (title, content, createdAt)
VALUES 
  ('hello', 'world', '2000-01-01');

-- 컬럼은 하나씩만 추가가 됬지만 데이터는 한번에 여러개 추가가 가능하다 
INSERT INTO 
  articles (title, content, createdAt)
VALUES
  ('title1', 'content1', '1900-01-01'),
  ('title2', 'content2', '1800-01-01'),
  ('title3', 'content3', '1700-01-01');

INSERT INTO 
  articles (title, content, createdAt)
VALUES 
  ('mytitle', 'mycontent', DATE());
```

## UPDATE

```sql
-- 2. Update data in table
UPDATE
  articles
SET 
  title = 'update title'
WHERE
  id = 1;

UPDATE
  articles
SET 
  title = 'update title',
  content = 'update Content'
WHERE
  id = 2;
```

## DELETE

```sql
-- 심화
DELETE FROM
  articles
-- WHERE id = "작성일이 오래된 순 상위 2개의 id 값"
WHERE id IN (
  SELECT id
  FROM articles
  ORDER BY createdAt
  LIMIT 2
);
```

# Multi table queries

### JOIN이 필요한 순간

- 테이블을 분리하면 데이터 관리는 용이해질 수 있으나 출력시에는 문제가 있음
- 테이블 한 개 만을 출력할 수 밖에 없어 다른 테이블과 결합하여 출력하는 것이 필요해짐

### JOIN 종류

1. INNER JOIN
    - 교집합 이라고 생각하면 됨
2. LEFT JOIN 
    - 왼쪽 테이블의 모든 레코드를 표기
    - 오른쪽 테이블과 매칭되는 레코드가 없으면 NULL을 표기

## JOIN

```sql
-- INNER JOIN
-- 조인할 때, 각 테이블의 이름을 붙여주는게 명확하다(중복될 경우를 대비)
SELECT articles.title, users.name FROM articles
INNER JOIN users
  ON articles.userid = users.id;

SELECT articles.title, users.name FROM articles
INNER JOIN users
  ON articles.userid = users.id
WHERE users.id = 1;

-- LEFT JOIN
SELECT * FROM articles
LEFT JOIN users
  on articles.userid = users.id;

SELECT users.name FROM users
LEFT JOIN articles
  on articles.userid = users.id
WHERE articles.content ISNULL;
```