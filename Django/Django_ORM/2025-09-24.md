데이터베이스와 통역하는 통역사 역할

## ORM (Object-Relational-Mapping)

- 객체 지향 프로그래밍 언어의 객체와 데이터베이스의 데이터를 매핑하는 기술
    - 파이썬으로 데이터베이스 쓰겠다는 의미

- 언어 차이로 인한 소통 불가를 해결
    - Django는 파이썬 ORM은 SQL
    - ORM이 그 사이에서 언어 번역자 역할을 수행
        - 개발자는 데이터베이스 구조를 잘 몰라도 파이썬 코드로 쉽게 데이터를 다룰 수 있음

- QuerySet API라는 특별한 도구를 제공한다

## QuerySet API

- DB의 복잡한 SQL 쿼리문을 직관적인 Python 코드로 다룰 수 있게 해주는 강력한 번역기
- .filter(), .exclude(), .order_by() 등
- 동작 방식
    - 우리가 쿼리셋 api 방식으로 명령을 하면 orm이 이를 sql로 db에 전달하고 sql응답을 QuerySet, instance형태로 바꿔줌
        - DB의 응답이 한개일땐 instance형태 다중일때는 QuerySet이라고 하는 대괄호로 감싸진 형태의 응답 객체로 넘어온다
- 기본 구조
    - `Article.objects.all()` : (게시글 전체 조회)
        - Model class는 Queryset API(명령할 도구)가 없기 때문에 이를 사용할 Manager가 필요하다
            - `Article` : Model class
                - 데이터베이스 테이블에 대한 python 클래스 표현
                - articles_article 테이블의 스키마를 정의하며 Django ORM이 데이터베이스와 상호 작용할 때 사용하는 기본적인 구조체
            - `.objects` : Manager
                - 데이터베이스 조회(Query)작업을 위한 기본 인터페이스
                - 이 매니저를 통해 쿼리 메서드를 호출
            - `.all()` : Queryset API
                - 특정 데이터베이스 작업을 수행하는 명령
                - 매니저를 통해 호출되는 메서드
    

### Query란?

- 데이터베이스에 특정한 데이터를 보여 달라는 요청
- “쿼리문을 작성한다”
    - 원하는 데이터를 얻기 위해 데이터베이스에 요청을 보낼 코드를 작성한다
- Django에서 Query가 처리되는 과정 정리
    1. 파이썬 코드 → ORM: 개발자의 QuerySet API가 ORM을 전달
    2. ORM → SQL 변환: ORM이 를 데이터베이스용 SQL 쿼리로 변환하여 데이터베이스에 전달
    3. DB응답 → ORM: 데이터베이스가 SQL 쿼리를 처리하고 결과 데이터를 ORM에 반환
    4. ORM → QuerySet 변환: ORM 이 데이터베이스 결과를 QuerySet형태로 변환하여 우리에게 전달 

**QuerySet이란**

- 데이터베이스에서 전달받은 객체 목록(데이터 모음)
- 순회 가능한 데이터로 1개 이상 데이터를 불러와 사용 가능함
- Django ORM을 통해 만들어진 자료형
- 단, 데이터베이스가 단일 객체를 반환할 때는 QuerySet이 아닌 모델(Class)의 인스턴스로 반환됨

### CRUD

- 대부분의 소프트웨어가 가지는 기본적인 데이터 처리 기능인 생성, 조회, 수정, 삭제를 묶어 이르는 말

### C(RUD) : Create

- QuerySet API 실습 사전 준비
    - 외부 라이브러리 설치 및 의존성 기록
        - Ipython은 파이썬 셸보다 자동 완성 등 편리한 작업 환경을 만들어주는 도구
            
            ```bash
            pip install ipython
            pip freeze > requirements.txt # 설치하면 기록해주자! 버전관리는 매우 중요 
            ```
            
    - Django Shell 접속하기: Django Shell 이란?
        - 파이썬 셸은  `python -i` 하면 파이썬 환경이 켜짐. 이건 파이썬이 켜준 장고랑 아무런 관련이 없는 환경임. 장고의 명령어는 실행되지 않음. 끄는 방법은 `exit()` / 아니면  `ctrl+c` 계속 눌러 강제 종료
        - Django Shell은 `python manage.py shell` 로 접속.
            - Django 프로젝트의 코드를 명령창에서 바로 실행하고 테스트하는 특별한 파이썬 환경
            - Django 환경 내에서 실행되기 때문에 입력하는 QuerySet API 구문이 Django 프로젝트에 영향을 미침
    - Shell “-v” 옵션 (기본값:1)
        - 좀따적기

- **데이터 객체를 만드는 3가지 방법**
    1. 빈 객체 생성 후 값 할당 및 저장
    2. 초기 값과 함께 객체 생성 및 저장
    3. creat() 메서드로 한 번에 생성 및 저장
    
    다 같은 방법임
    

- 첫번째 방법
    
    장고 셸에서 진행
    

장고에서 데이터를 쓸 준비를 한 것이지 아직 데이터베이스는 모름, 아직 데이터가 안 올라감(조회도 안됨)

article.save() 인스턴스 메서드를 호출하면 저장해줘 라고 하는 것. 저장됨. 그리고 이 메서드는 Article클래스가 상속 받은 Model클래스에서 정의된 것임 

- 두번째 방법: 초기 값과 함께 객체 생성 및 저장
    
    이것도 save무조건해줘야 pk가 생김
    
    테이블에 한 행이 쓰여진 것
    

**save() 란** : 객체를 데이터베이스에 저장하는 인스턴스 메서드

- 객체를 먼저 생성한 후, 데이터베이스에 저장하기 전에 추가적인 처리(관계 설정, 유효성 검사)가 필요할 때 save() 호출

- 세번째 방법: create() 메서드로 save()를 쓰지 않고 한 번에 생성 및 저장

### (C)R(UD) : Read

- QuerySet 반환 메서드
    - all()
    - filter()

all과 filter는 다중이든 단일이든 queryset객체를 반환

- get()

목적은 객체하나를 가져오는 거라서 pk같은걸로 가져와야 됨. 그값이 없거나 여러개면 안된다

### (CR)U(D): Update

조회먼저

### (CRU)D: Delete

조회먼저 

이놈은 save()가 필요없음 바로지워짐 

save는 저장 행위 인데 지우는 거니까 그냥 지워지는 것  

## ORM with view

- View함수에서 QuerySet API 활용하기
    - View에서의 QuerySet API:
        - 웹 페이지에 보여줄 데이터를 DB에서 가져올 때 사용함
        - 사용자가 입력한 새로운 데이터를 DB에 저장할 때 사용함
            - 2가지 Read(조회)
                1. 전체 게시글 조회
                2. 단일 게시글 조회